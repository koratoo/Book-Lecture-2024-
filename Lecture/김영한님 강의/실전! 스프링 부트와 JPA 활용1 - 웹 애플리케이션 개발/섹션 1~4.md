# 목차

## [1. 프로젝트 환경설정](#1-프로젝트-환경설정)

- [1.1 프로젝트 생성](#11-프로젝트-생성)
- [1.2 라이브러리 살펴보기](#12-라이브러리-살펴보기)
- [1.3 View 환경 설정](#13-view-환경-설정)
- [1.4 H2 데이터베이스 설치](#14-h2-데이터베이스-설치)
- [1.5 JPA와 DB 설정, 동작확인](#15-jpa와-db-설정-동작확인)

## [2. 도메인 분석 설계](#2-도메인-분석-설계)

- [2.1 요구사항 분석](#21-요구사항-분석)
- [2.2 도메인 모델과 테이블 설계](#22-도메인-모델과-테이블-설계)
- [2.3 엔티티 클래스 개발1](#23-엔티티-클래스-개발1)
- [2.4 엔티티 클래스 개발2](#24-엔티티-클래스-개발2)
- [2.5 엔티티 설계시 주의점](#25-엔티티-설계시-주의점)

## [3. 애플리케이션 구현 준비](#3-애플리케이션-구현-준비)

- [3.1 구현 요구사항](#31-구현-요구사항)
- [3.2 애플리케이션 아키텍처](#32-애플리케이션-아키텍처)

## [4. 회원 도메인 개발](#4-회원-도메인-개발)

- [4.1 회원 리포지토리 개발](#41-회원-리포지토리-개발)
- [4.2 회원 서비스 개발](#42-회원-서비스-개발)
- [4.3 회원 기능 테스트](#43-회원-기능-테스트)

# 1. 프로젝트 환경설정

## 1.1 프로젝트 생성

- H2, JPA, lombok, Thymeleaf

## 1.2 라이브러리 살펴보기

- 핵심 라이브러리 : 스프링MVC, 스프링ORM, JPA
- 기타 라이브러리 : H2, 커넥션풀, WEB, 로깅, 테스트
- 스프링 데이터JPA는 스프링과 JPA를 먼저 이해하고 사용해야 하는 응용기술이다.

## 1.3 View 환경 설정

- thymeleaf

## 1.4 H2 데이터베이스 설치

- 개발이나 테스트 용도로 가볍고 편리함.
- tcp를 통한 네트워크 모드로 접근해야한다.

## 1.5 JPA와 DB 설정, 동작확인

# 2. 도메인 분석 설계

## 2.1 요구사항 분석

- 회원가입, 상품등록, 상품주문, 상품 내역 확인
- 상품을 카테고리로 구분할 수 있다.
- 상품 주문시 배송정보를 입력할 수 있다.

## 2.2 도메인 모델과 테이블 설계

- 다대다 관계는 일반적으로 사용하지 않아서 중간에 엔티티를 추가해서 1대다, 다대1 관계를 만들어준다.

## 2.3 엔티티 클래스 개발1

- 엔티티 클래스 개발1

## 2.4 엔티티 클래스 개발2

- 엔티티 클래스 개발2

## 2.5 엔티티 설계시 주의점

- 엔티티 설계시 주의점

# 3. 애플리케이션 구현 준비

## 3.1 구현 요구사항

- 단순한 구현

## 3.2 애플리케이션 아키텍처

- 계층형 구조 사용
- 컨트롤러, 서비스, 레포지토리, 도메인
- 서비스 : 비즈니스, 트랜잭션
- 레포지토리 : JPA를 직접 사용
- 도메인 : 엔티티가 모여있는 계층

```java
 jpabook.jpashop
  ㄴ domain
  ㄴ exception
  ㄴ repository
  ㄴ service
  ㄴ web
```

# 4. 회원 도메인 개발

## 4.1 회원 리포지토리 개발

- 엔티티코드 -> 리포지토리
- `@PersistenceContext`는 Java EE와 Spring에서 JPA (Java Persistence API)를 사용할 때 엔티티 매니저(EntityManager)를 주입(inject)하는 데 사용되는 어노테이션이다. 이는 주로 DAO (Data Access Object) 또는 리포지토리 클래스에서 사용되어 JPA를 통해 데이터베이스 작업을 수행할 수 있도록 한다.

- JPQL : SQL과 기능적으로 동일하나 SQL은 테이블대상, JPQL은 엔티티를 대상으로 한다.

```java
// JPQL을 사용한 예제
String jpql = "SELECT m FROM Member m WHERE m.name = :name";
TypedQuery<Member> query = em.createQuery(jpql, Member.class);
query.setParameter("name", "John");
List<Member> results = query.getResultList();
```

## 4.2 회원 서비스 개발

- 회원가입시 필요한 로직
- 중복회원 검증로직(비즈니스로직) : 엔티티가 영속성 컨텍스트에 포함되어 영속 상태가 되면 그때 ID가 할당되고 존재하게 된다.
- 예외처리: `throw new IllegalStateException("이미 존재하는 회원입니다.")`
- JPA사용시 웬만하면 `@Transactional` 어노테이션이 있어야 한다.

## 4.3 회원 기능 테스트

- `@Test(expected = IllegalStateException.class)` 테스트 어노테이션에 예외를 붙여 쓸 수 있다.
